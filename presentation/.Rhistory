BD_ModDR$Carro   <- NULL
BD_ModDR <- BD_ModDR %>% rename(AGE     = EDAD,
HH_SIZE = NUMERO_PERSONAS,
DISTANCE= Dist_Red,
LONG = LONGITUD_ORIGEN,
LAT  = LATITUD_ORIGEN)
BD_ModDR <- BD_ModDR %>%
select(ID_ENCUESTA,NUMERO_PERSONA,NUMERO_VIAJE,CODPERS,CODVIAJ,LONG,LAT,DISTANCE,PURPOSE,
MODE_T,AGE,GENDER,DRV_LICENSE,HH_SIZE,OCCUPATION,INCOME,CAR_OWN,EntScore)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
library(tidyverse)
BD_ModDR <- readRDS("H:/My Drive/2022 2/DS/project/model EODH2015/BD_ModDR.rds")
# Coding gender
BD_ModDR$GENDER <- recode_factor(BD_ModDR$ID_SEXO,
Hombre = "Male",
Mujer  = "Female")
BD_ModDR$ID_SEXO <- NULL
# Coding driver license
BD_ModDR$DRV_LICENSE <- recode_factor(BD_ModDR$ID_LICENCIACONDUCCION1,
NO_LICENCIA = "NO",
LICENCIA    = "YES")
BD_ModDR$ID_LICENCIACONDUCCION1 <- NULL
# Coding car ownership
BD_ModDR$Carro   <- ifelse(BD_ModDR$Carro >= 2,2,BD_ModDR$Carro)
BD_ModDR$CAR_OWN <- as.factor(BD_ModDR$Carro)
BD_ModDR$Carro   <- NULL
BD_ModDR <- BD_ModDR %>% rename(AGE     = EDAD,
HH_SIZE = NUMERO_PERSONAS,
DISTANCE= Dist_Red,
LONG = LONGITUD_ORIGEN,
LAT  = LATITUD_ORIGEN)
# Final selection of potential variables to include in the model
BD_ModDR <- BD_ModDR %>%
select(ID_ENCUESTA,NUMERO_PERSONA,NUMERO_VIAJE,CODPERS,CODVIAJ,LONG,LAT,DISTANCE,PURPOSE,
MODE_T,AGE,GENDER,DRV_LICENSE,HH_SIZE,OCCUPATION,INCOME,CAR_OWN,EntScore)
saveRDS(BD_ModDR,"BD_ModDR.rds") # save data for second step
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
library(tidyverse)
BD_ModDR <- readRDS("BD_ModDR")
BD_ModDR <- readRDS("BD_ModDR.rds")
head(BD_ModDR)
min(BD_ModDR$OCCUPATION)
mean(BD_ModDR$OCCUPATION)
min(as.numeric(BD_ModDR$OCCUPATION))
max(as.numeric(BD_ModDR$OCCUPATION))
summarise(BD_ModDR)
summary(BD_ModDR)
summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb<-summary(BD_ModDR %>% select(DISTANCE:EntScore))
library(kableExtra)
tb %>%
kbl() %>%
kable_styling()
tb %>%
kbl() %>%
kable_paper("hover", full_width = F)
tb %>%
kbl() %>%
kable_minimal()
tb
is.na(tb)
as.data.frame(tb)
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_minimal()
tb %>%
kbl() %>%
kable_classic_2(full_width = F)
tb %>%
kbl() %>%
kable_classic_2(bootstrap_options = "striped",full_width = F)
tb %>%
kbl() %>%
kable_classic_2(full_width = T)
tb %>%
kbl() %>%
kable_classic_2(full_width = T) %>%
column_spec(width = "30em")
tb %>%
kbl() %>%
kable_material(c("striped", "hover"))
ggplot(BD_ModDR,aes(x=ID_MEDIO_PREDOMINANTE,y=Dist_Red))+
geom_boxplot()
ggplot(BD_ModDR,aes(x=MODE_T,y=DISTANCE))+
geom_boxplot()
ggplot(BD_ModDR,
aes(x=MODE_T,y=DISTANCE))+
geom_boxplot()+
xlab("Transportation mode")
BD_ModDR <- readRDS("BD_ModDR.rds")
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "hover"), full_width = F)
BD_ModDR <- readRDS("BD_ModDR.rds")
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "hover"), full_width = T)
ggplot(BD_ModDR,
aes(x=MODE_T,y=DISTANCE))+
geom_boxplot()+
xlab("Transportation mode")+
ylab("Distance (Km)")
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "hover"), full_width = T)
ggplot(BD_ModDR,
aes(x=MODE_T,y=DISTANCE))+
geom_boxplot()+
xlab("Transportation mode")+
ylab("Distance (Km)")
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"), full_width = T)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
cor_tb = cor(BD_ModDR)
cor_tb = cor(BD_ModDR %>% select(DISTANCE:EntScore))
cor_tb = cor(BD_ModDR %>% select(DISTANCE:EntScore) %>% as.numeric())
BD_ModDR %>% select(DISTANCE:EntScore) %>% as.numeric()
View(BD_ModDR)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
library(tidyverse)
library(kableExtra)
BD_ModDR <- readRDS("BD_ModDR.rds")
View(BD_ModDR)
names(BD_ModDR)
summary(model <- lm((DISTANCE) ~
GENDER    +
AGE       + I(AGE^2)  +
OCCUPATION + INCOME   +
IMODE_T   +
EntScore,
data = BD_ModDR))
summary(model <- lm((DISTANCE) ~
GENDER    +
AGE       + I(AGE^2)  +
OCCUPATION + INCOME   +
MODE_T   +
EntScore,
data = BD_ModDR))
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed")) %>%
kable_styling()%>%
scroll_box()
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box()
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "500px", height = "400px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "500px", height = "600px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "500px", height = "500px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "500px", height = "490px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "500px", height = "480px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "600px", height = "480px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "700px", height = "480px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "800px", height = "480px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "800px", height = "470px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "900px", height = "460px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "800px", height = "460px")
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "800px", height = "455px")
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "900px", height = "455px")
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$DISTANCE <- BD_ModDR$DISTANCE/1000
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
library(tidyverse)
library(tidyverse)
library(kableExtra)
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "905px", height = "455px")
saveRDS(BD_ModDR,"BD_ModDR.rds")
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "905px", height = "455px")
head(BD_ModDR)
# Libraries
library(sf)
BD_ModDR$LONG <- as.numeric(gsub(",", ".", BD_ModDR$LONG))
BD_ModDR$LAT  <- as.numeric(gsub(",", ".", BD_ModDR$LAT))
head(BD_ModDR)
BD <- st_as_sf(BD, coords = c("LONG", "LAT"),crs = 4326)
BD <- st_as_sf(BD_ModDR, coords = c("LONG", "LAT"),crs = 4326)
UTAM <- st_read("H:/My Drive/Encuesta de Movilidad 2019_SUR/ZONAS/UTAM.shp")
UTAM <- st_transform(UTAM,crs = 4326)
zones <- unique(UTAM$UTAM)
View(UTAM)
UTAM2 <- UTAM %>% Filter(UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5"))
UTAM2 <- UTAM %>% Filter(UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5"))
UTAM2 <- UTAM %>% Filter(UTAM$UTAM %in% c("UPR1","UPR2","UPR3","UPR4","UPR5"))
UTAM2 <- UTAM[UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5"),]
`%notin%` <- Negate(`%in%`)
UTAM2 <- UTAM[UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5"),]
table((UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5"))&
UTAM$MUNNombre=="BOGOTA")
UTAM2 <- UTAM[(UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5"))&
UTAM$MUNNombre=="BOGOTA",]
plot(UTAM2)["MUNNombre"]
BD_ModDR <- readRDS("BD_ModDR.rds")
BD_ModDR$LONG <- as.numeric(gsub(",", ".", BD_ModDR$LONG))
BD_ModDR$LAT  <- as.numeric(gsub(",", ".", BD_ModDR$LAT))
BD <- st_as_sf(BD_ModDR, coords = c("LONG", "LAT"),crs = 4326)
UTAM <- st_read("H:/My Drive/Encuesta de Movilidad 2019_SUR/ZONAS/UTAM.shp")
UTAM <- st_transform(UTAM,crs = 4326)
UTAM <- UTAM[UTAM$MUNNombre=="BOGOTA" &
(UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5")),]
zones <- unique(UTAM$UTAM)
`%notin%` <- Negate(`%in%`)
UTAM <- UTAM[UTAM$MUNNombre=="BOGOTA" &
(UTAM$UTAM %notin% c("UPR1","UPR2","UPR3","UPR4","UPR5")),]
zones <- unique(UTAM$UTAM)
BD <- st_intersection(BD,UTAM[,"UTAM"])
saveRDS(BD,"BD_geo.rds")
GENDER     <- unique(BD$GENDER)
OCCUPATION <- unique(BD$OCCUPATION)
MODE_T     <- unique(BD$MODE_T)
map_data <- BD %>%
st_drop_geometry() %>%
group_by(UTAM,GENDER,OCCUPATION,MODE_T) %>%
summarise("dist"= mean(DISTANCE))
map <- crossing(zones,GENDER,OCCUPATION,MODE_T)
View(map_data)
map <- merge(map,map_data,
by.x = c("zones","GENDER","OCCUPATION","MODE_T"),
by.y = c("UTAM", "GENDER","OCCUPATION","MODE_T"),
all.x = T)
View(map)
alter_dist <- BD %>%
st_drop_geometry() %>%
group_by(MODE_T) %>%
summarise("dist"= mean(DISTANCE))
View(alter_dist)
View(map)
map <- merge(map,alter_dist,
by = "MODE_T",
all.x = T)
View(map)
map$DISTANCE <- ifelse(is.na(map$dist.x),map$dist.y,map$dist.x)
map <- map %>%
mutate(dist.x=NULL,
dist.y=NULL)
View(map)
names(map)
map <- merge(map,UTAM[,"UTAM"],
by.x = "zones",
by.y = "UTAM",
all.x = T)
View(map)
saveRDS(map,"map.rds")
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
# Libraries
library(tidyverse)
library(kableExtra)
BD_ModDR <- readRDS("BD_ModDR.rds")
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "905px", height = "455px")
ggplot(BD_ModDR,
aes(x=MODE_T,y=DISTANCE))+
geom_boxplot()+
xlab("Transportation mode")+
ylab("Distance (Km)")
options(scipen = 999)
summary(model <- lm(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = BD_ModDR))
options(scipen = 999, digits = 3)
summary(model <- lm(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = BD_ModDR))
saveRDS(model,"model1.rds")
shiny::runApp('H:/My Drive/2022 2/DS/project/app')
all_modzcta <- readRDS("H:/My Drive/2022 2/DS/project/app/map.rds")
all_modzcta$DISTANCE <- round(all_modzcta$DISTANCE,3)
head(all_modzcta$DISTANCE)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
# Libraries
library(tidyverse)
library(kableExtra)
library(randomForest)
library(MASS)
BD_ModDR <- readRDS("BD_ModDR.rds")
set.seed (1)
s_train<- sample(1: nrow(BD_ModDR), nrow(BD_ModDR)*0.8)
train  <-  BD_ModDR[s_train,] %>%
select(DISTANCE:EntScore)
train  <-  BD_ModDR %>%
slice(s_train)
y_test <- BD_ModDR[-s_train, "DISTANCE"]
hist(y_test,breaks = 100)
summary(model <- lm(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
BD_ModDR$DISTANCEF <-cut(BD_ModDR$DISTANCE)
BD_ModDR$DISTANCEF <-cut(BD_ModDR$DISTANCE,4)
table(BD_ModDR$DISTANCE)
table(BD_ModDR$DISTANCEF)
BD_ModDR$DISTANCEF <-cut(BD_ModDR$DISTANCE,5)
table(BD_ModDR$DISTANCEF)
BD_ModDR <- readRDS("BD_ModDR.rds")
set.seed (1)
s_train<- sample(1: nrow(BD_ModDR), nrow(BD_ModDR)*0.8)
train  <-  BD_ModDR %>%
slice(s_train) %>%
select(DISTANCE:EntScore)
train  <-  BD_ModDR %>%
slice(s_train) %>%
select(DISTANCE:EntScore)
BD_ModDR %>% select(DISTANCE:EntScore)
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
names(BD_ModDR)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
# Libraries
library(kableExtra)
library(randomForest)
library(MASS)
library(tidyverse)
BD_ModDR <- readRDS("BD_ModDR.rds")
tb <- summary(BD_ModDR %>% select(DISTANCE:EntScore))
tb[is.na(tb)]<-""
tb %>%
kbl() %>%
kable_material(c("striped", "condensed"),full_width = F) %>%
kable_styling()%>%
scroll_box(width = "905px", height = "455px")
options(scipen = 999, digits = 3)
BD_ModDR <- readRDS("BD_ModDR.rds")
set.seed (1)
s_train<- sample(1: nrow(BD_ModDR), nrow(BD_ModDR)*0.8)
train  <-  BD_ModDR %>%
slice(s_train) %>%
select(DISTANCE:EntScore)
y_test <- BD_ModDR[-s_train, "DISTANCE"]
train  <-  BD_ModDR %>%
select(DISTANCE:EntScore) %>%
mutate(DISTANCE = cut(DISTANCE,5)) %>%
slice(s_train)
head(train)
str(train$DISTANCE)
levels(train$DISTANCE)
summary(model <- polr(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
summary(model <- polr(DISTANCE ~ GENDER + (AGE/10) + I((AGE/10)^2) + OCCUPATION + INCOME + MODE_T + (EntScore*10),
data = train))
summary(model <- polr(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
train  <-  BD_ModDR %>%
select(DISTANCE:EntScore) %>%
mutate(DISTANCE = cut(DISTANCE,5),
AGE      = AGE/10,
EntScore = EntScore*10) %>%
slice(s_train)
summary(model <- polr(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
model2 <- readRDS("model2.rds")
summary(model2)
model2
train  <-  BD_ModDR %>%
select(DISTANCE:EntScore) %>%
mutate(DISTANCE = cut(DISTANCE,5),
AGE      = AGE/10,
EntScore = EntScore*10) %>%
slice(s_train)
summary(model <- lm(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
summary(model <- lm(as.numeric(DISTANCE) ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
options(scipen = 999, digits = 3)
BD_ModDR <- readRDS("BD_ModDR.rds")
set.seed (1)
s_train<- sample(1: nrow(BD_ModDR), nrow(BD_ModDR)*0.8)
train  <-  BD_ModDR %>%
slice(s_train) %>%
select(DISTANCE:EntScore)
# Libraries
library(kableExtra)
library(randomForest)
library(MASS)
library(tidyverse)
options(scipen = 999, digits = 3)
BD_ModDR <- readRDS("BD_ModDR.rds")
set.seed (1)
s_train<- sample(1: nrow(BD_ModDR), nrow(BD_ModDR)*0.8)
train  <-  BD_ModDR %>%
slice(s_train) %>%
select(DISTANCE:EntScore)
y_test <- BD_ModDR[-s_train, "DISTANCE"]
summary(model <- lm(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
#saveRDS(model,"model1.rds")
train  <-  BD_ModDR %>%
select(DISTANCE:EntScore) %>%
mutate(DISTANCE = cut(DISTANCE,5),
AGE      = AGE/10,
EntScore = EntScore*10) %>%
slice(s_train)
summary(model <- polr(DISTANCE ~ GENDER + AGE + I(AGE^2) + OCCUPATION + INCOME + MODE_T + EntScore,
data = train))
test  <-  BD_ModDR %>%
select(DISTANCE:EntScore) %>%
mutate(DISTANCE = cut(DISTANCE,5),
AGE      = AGE/10,
EntScore = EntScore*10) %>%
slice(-s_train)
yhat_test <- predict(model, newdata = test)
yhat_test
model <- readRDS("model2.rds")
model
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=4, fig.align = "center")
model <- readRDS("model2.rds")
model
varImpPlot(model)
